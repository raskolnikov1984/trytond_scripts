#!/usr/bin/env python3
from proteus import Model, config, Wizard
import datetime

notas = [
        "FPSE496",
        "FPSE495",
        "FPSE494",
        "FPSE493",
        "FPSE492",
        "FPSE491",
        "FPSE490",
        "FPSE489",
        "FPSE488",
        "FPSE487",
        "FPSE486",
        "FPSE485",
        "FPSE484",
        "FPSE483",
        "FPSE482",
        "FPSE481",
        "FPSE480",
        "FPSE479",
        "FPSE477",
        "FPSE476",
        "FPSE475",
        "FPSE474",
        "FPSE473",
        "FPSE472",
        "FPSE471",
        "FPSE470",
        "FPSE469",
        "FPSE468",
        "FPSE467",
        "FPSE466",
        "FPSE465",
        "FPSE464",
        "FPSE463",
        "FPSE462",
        "FPSE461",
        "FPSE460",
        "FPSE459",
        "FPSE458",
        "FPSE457",
        "FPSE456",
        "FPSE455",
        "FPSE453",
        "FPSE452",
        "FPSE451",
        "FPSE450",
        "FPSE449",
        "FPSE448",
        "FPSE447",
        "FPSE446",
        "FPSE445",
        "FPSE444",
        "FPSE443",
        "FPSE442",
        "FPSE441",
        "FPSE440",
        "FPSE439",
        "FPSE438",
        "FPSE437",
        "FPSE436",
        "FPSE435",
        "FPSE434",
        "FPSE433",
        "FPSE432",
        "FPSE431",
        "FPSE430",
        "FPSE429",
        "FPSE428",
        "FPSE427",
        "FPSE426",
        "FPSE425",
        "FPSE424",
        "FPSE423",
        "FPSE422",
        "FPSE421",
        "FPSE420",
        "FPSE419",
        "FPSE418",
        "FPSE416",
        "FPSE415",
        "FPSE414",
        "FPSE413",
        "FPSE410",
        "FPSE409",
        "FPSE407",
        "FPSE406",
        "FPSE404",
        "FPSE403",
        "FPSE402",
        "FPSE401",
        "FPSE400",
        "FPSE399",
        "FPSE398",
        "FPSE397",
        "FPSE396",
        "FPSE395",
        "FPSE394",
        "FPSE393",
        "FPSE392",
        "FPSE390",
        "FPLS899",
        "FPLS898",
        "FPLS897",
        "FPLS896",
        "FPLS895",
        "FPLS894",
        "FPLS893",
        "FPLS892",
        "FPLS891",
        "FPLS890",
        "FPLS888",
        "FPLS887",
        "FPLS886",
        "FPLS885",
        "FPLS884",
        "FPLS883",
        "FPLS882",
        "FPLS881",
        "FPLS879",
        "FPLS877",
        "FPLS876",
        "FPLS875",
        "FPLS873",
        "FPLS872",
        "FPLS871",
        "FPLS870",
        "FPLS869",
        "FPLS868",
        "FPLS867",
        "FPLS866",
        "FPLS865",
        "FPLS864",
        "FPLS863",
        "FPLS862",
        "FPLS861",
        "FPLS860",
        "FPLS859",
        "FPLS858",
        "FPLS857",
        "FPLS855",
        "FPLS854",
        "FPLS853",
        "FPLS852",
        "FPLS851",
        "FPLS850",
        "FPLS849",
        "FPLS848",
        "FPLS847",
        "FPLS846",
        "FPLS845",
        "FPLS844",
        "FPLS843",
        "FPLS841",
        "FPLS840",
        "FPLS839",
        "FPLS838",
        "FPLS837",
        "FPLS836",
        "FPLS835",
        "FPLS834",
        "FPLS833",
        "FPLS832",
        "FPLS831",
        "FPLS830",
        "FPLS829",
        "FPLS828",
        "FPLS827",
        "FPLS826",
        "FPLS825",
        "FPLS823",
        "FPLS822",
        "FPLS821",
        "FPLS820",
        "FPLS819",
        "FPLS818",
        "FPLS817",
        "FPLS816",
        "FPLS815",
        "FPLS814",
        "FPLS812",
        "FPLS810",
        "FPLS809",
        "FPLS808",
        "FPLS806",
        "FPLS805",
        "FPLS804",
        "FPLS803",
        "FPLS801",
        "FPLS800",
        "FPLS799",
        "FPLS798",
        "FPLS797",
        "FPLS795",
        "FPLS794",
        "FPLS793",
        "FPLS792",
        "FPLS791",
        "FPLS790",
        "FPLS789",
        "FPLS788",
        "FPLS787",
        "FPLS786",
        "FPLS785",
        "FPLS784",
        "FPLS783",
        "FPLS782",
        "FPLS781",
        "FPLS780",
        "FPLS779",
        "FPLS777",
        "FPLS776",
        "FPLS775",
        "FPLS774",
        "FPLS772",
        "FPLS771",
        "FPLS770",
        "FPLS769",
        "FPLS768",
        "FPLS767",
        "FPLS766",
        "FPLS765",
        "FPLS764",
        "FPLS763",
        "FPLS762",
        "FPLS761",
        "FPLS760",
        "FPLS759",
        "FPLS757",
        "FPLS755",
        "FPLS753",
        "FPLS752",
        "FPLS751",
        "FPLS750",
        "FPLS749",
        "FPLS748",
        "FPLS747",
        "FPLS746",
        "FPLS745",
        "FPLS744",
        "FPLS743",
        "FPLS742",
        "FPLS741",
        "FPLS740",
        "FPLS739",
        "FPLS738",
        "FPLS737",
        "FPLS736",
        "FPLS735",
        "FPLS734",
        "FPLS733",
        "FPLS732",
        "FPLS731",
        "FPLS730",
        "FPLS729",
        "FPLS728",
        "FPLS727",
        "FPLS726",
        "FPLS725",
        "FPLS724",
        "FPLS723",
        "FPLS722",
        "FPLS721",
        "FPLS720",
        "FPLS719",
        "FPLS718",
        "FPLS717",
        "FPLS716",
        "FPLS714",
        "FPLS712",
        "FPLS711",
        "FPLS710",
        "FPLS709",
        "FPLS708",
        "FPLS707",
        "FPLS705",
        "FPLS704",
        "FPLS703",
        "FPLS702",
        "FPLS701",
        "FPLS700",
        "FPLS699",
        "FPLS698",
        "FPLS697",
        "FPLS696",
        "FPLS695",
        "FPLS694",
        "FPLS693",
        "FPLS692",
        "FPLS691",
        "FPLS690",
        "FPLS689",
        "FPLS687",
        "FPLS686",
        "FPLS685",
        "FPLS684",
        "FPLS683",
        "FPLS682",
        "FPLS681",
        "FPLS680",
        "FPLS679",
        "FPLS678",
        "FPLS677",
        "FPLS676",
        "FPLS675",
        "FPLS674",
        "FPLS673",
        "FPLS672",
        "FPLS671",
        "FPLS670",
        "FPLS669",
        "FPLS668",
        "FPLS667",
        "FPLS666",
        "FPLS665",
        "FPLS663",
        "FPLS662",
        "FPLS661",
        "FPLS660",
        "FPLS659",
        "FPLS658",
        "FPLS657",
        "FPLS656",
        "FPLS651",
        "FPLS633",
        "FPLS598",
        "FPLS597",
        "FPLS596",
        "FPLS595",
        "FPLS594",
        "FPLS593",
        "FPLS592",
        "FPLS591",
        "FPLS590",
        "FPLS588",
        "FPLS587",
        "FPLS586",
        "FPLS585",
        "FPLS584",
        "FPLS583",
        "FPLS582",
        "FPLS581",
        "FPLS580",
        "FPLS579",
        "FPLS578",
        "FPLS577",
        "FPLS576",
        "FPLS575",
        "FPLS574",
        "FPLS573",
        "FPLS572",
        "FPLS571",
        "FPLS570",
        "FPLS569",
        "FPLS568",
        "FPLS567",
        "FPLS566",
        "FPLS565",
        "FPLS564",
        "FPLS563",
        "FPLS562",
        "FPLS561",
        "FPLS560",
        "FPLS559",
        "FPLS558",
        "FPLS557",
        "FPLS556",
        "FPLS555",
        "FPLS554",
        "FPLS553",
        "FPLS552",
        "FPLS551",
        "FPLS550",
        "FPLS549",
        "FPLS548",
        "FPLS547",
        "FPLS546",
        "FPLS545",
        "FPLS544",
        "FPLS543",
        "FPLS542",
        "FPLS541",
        "FPLS540",
        "FPLS539",
        "FPLS538",
        "FPLS537",
        "FPLS536",
        "FPLS535",
        "FPLS534",
        "FPLS533",
        "FPLS532",
        "FPLS531",
        "FPLS530",
        "FPLS529",
        "FPLS528",
        "FPLS527",
        "FPLS526",
        "FPLS525",
        "FPLS524",
        "FPLS523",
        "FPLS521",
        "FPLS520",
        "FPLS519",
        "FPLS518",
        "FPLS517",
        "FPLS516",
        "FPLS515",
        "FPLS514",
        "FPLS512",
        "FPLS511",
        "FPLS510",
        "FPLS509",
        "FPLS508",
        "FPLS506",
        "FPLS505",
        "FPLS504",
        "FPLS503",
        "FPLS502",
        "FPLS501",
        "FPLS500",
        "FPLS498",
        "FPLS497",
        "FPLS496",
        "FPLS495",
        "FPLS494",
        "FPLS184"]

database = 'notas_credito'
config_file = '/etc/trytond.conf'
config.set_trytond(database, config_file=config_file)
Invoices = Model.get('account.invoice')


def duplicate_invoice(invoice):
    new_invoice, = invoice.duplicate()
    new_invoice.invoice_date = invoice.invoice_date
    new_invoice.subtype = 17
    new_invoice.save()
    return new_invoice


def return_invoice(invoice):
    if invoice:
        return_invoice = Wizard('account.invoice.credit', [invoice])
        return_invoice.form.with_refund = False
        return_invoice.form.invoice_date = datetime.date.today()
        return_invoice.execute('credit')


def complete_return_invoice_origin():
    credit_notes = Invoices.find([
        ('type', '=', 'out'),
        ('state', '=', 'draft'),
        ('total_amount', '<', 0)])

    for ncc in credit_notes:
        ncc.subtype = 18
        ncc.reference = "Notas Credito Fallo en el EnvÃ­o"
        invoice_origin = ncc.lines[0].origin.invoice
        ncc.fe_document_reference = invoice_origin.id
        ncc.invoice_date = invoice_origin.invoice_date
        ncc.fe_document = True
        ncc.fe_operation_type = '20'
        ncc.credit_note = True
        ncc.save()


if __name__ == '__main__':
    for number in notas:
        invoice, = Invoices.find(['number', '=', number])
        return_invoice(invoice)
        duplicate_invoice(invoice)
    config.set_trytond(database, config_file=config_file)
    complete_return_invoice_origin()
    # print("La Cantidad de Notas Credito es: ", len(credit_notes))
